/Users/user/eclipse.platform.ui/tests/org.eclipse.ui.monitoring.tests/src/org/eclipse/ui/internal/monitoring/EventLoopMonitorThreadManualTests.java
org eclipse internal monitoring org junit assert equals org junit assert not null org junit assert true java lang management management factory java lang management thread bean java util array deque java util array list java util linked list java util list java util queue java util random java util concurrent count down latch java util concurrent time unit org eclipse jface preference preference store org eclipse swt widgets display org eclipse monitoring preference constants org junit after org junit before org junit test test measures performance overhead link event loop monitor thread this test included link monitoring test suite reliability amount time takes event loop monitor thread manual tests change code true enable printing detailed console false test parameters time measurement this affect number samples collected seconds maximum allowable relative increase traces thread maximum allowable relative increase thread traces threads number times repeat control measurement this number times repeat stack sampling measurement number times repeat stacks sampling measurement calibration tuning parameters number work units integrate calibrating this parameter adjust work capture jitter large oscillate large events converging iterations number consecutive iterations error threshold defined link accepting calibration result due occasional jitter scheduling large values converge iterations number outliers relative samples tolerate calculating convergence calibration tolerated points factored rolling average weight elements exponential averaging calibration optimal desired number samples average max relative error estimated previous estimate once relative error stabilizes threshold defined link iterations calibration complete pseudo random noise generator polynomial degree polynomial maximum sequence length wayne stahnke primitive polynomials modulo two http ams org journals mcom pdf call sequence period years before set preferences set value preference constants false after tear down preferences set default preference constants sequence bit bit sequence sequence bit work seqeuence iterations linked list string messages linked list iterations seqeuence seqeuence messages add messages size messages remove first messages add string format iteration string messages seqeuence hash code seqeuence performance test link event loop monitor thread this test verifies monitoring doesn interfere real work test test fixed work exception display display display default not null display display mock freeze event logger logger mock freeze event logger count down latch background jobs done count down latch queue thread threads start background threads background jobs done per work calibrate display num iterations math per work work work output runnable fixed amount work runnable override start system nano time result work start num iterations work system nano time start work output result fetch total number threads thread bean jvm thread manager management factory thread bean dump locked monitors jvm thread manager object monitor usage supported dump locked synchronizers jvm thread manager synchronizer usage supported total thread count jvm thread manager dump all threads dump locked monitors dump locked synchronizers length list double control results array list list double stack results array list list double stacks results array list expected running time max running time this precise measuring control loop times calculating standard deviation measuring test times calculating probability result comparing probability acceptable bound system println string format starting control measurements monitoring display sync exec fixed amount work system println string format control measurement finished work work control results add work expected running time work work max running time max running time work calculate error bound max control runs control diff math abs max running time expected running time expected running time max relative increase one stack allowed control diff max relative increase all stacks allowed total thread count control diff thread monitor create and start monitoring thread display false worst relative diff one thread double system println string format starting measurements collecting thread stacks display sync exec fixed amount work stack results add work relative diff one thread work expected running time expected running time relative diff one thread worst relative diff one thread worst relative diff one thread relative diff one thread system println string format measurement relative increase allowed work relative diff one thread max relative increase one stack allowed true string format relative overhead monitoring surpassed threshold measurement relative increase allowed work relative diff one thread max relative increase one stack allowed relative diff one thread max relative increase one stack allowed kill monitor thread monitor display thread monitor create and start monitoring thread display true worst relative diff all threads double system println string format starting measurements collecting thread stacks display sync exec fixed amount work stacks results add work relative diff all threads work expected running time expected running time relative diff all threads worst relative diff all threads worst relative diff all threads relative diff all threads system println string format measurement relative increase allowed work relative diff all threads max relative increase all stacks allowed true string format relative overhead monitoring stack traces threads surpassed threshold measurement relative increase allowed work relative diff all threads max relative increase all stacks allowed relative diff all threads max relative increase all stacks allowed kill monitor thread monitor display background jobs done count down tabulate waiting monitor finish control mean control min double control max double control control results size control results control results set delta control mean control mean delta control delta control mean control min math min control min control max math max control max control math sqrt control control results size stack mean stack min double stack max double stack stack results size stack results stack results set delta stack mean stack mean delta stack delta stack mean stack min math min stack min stack max math max stack max stacks mean stacks min double stacks max double stacks stacks results size stacks results stacks results set delta stacks mean stacks mean delta stacks delta stacks mean stacks min math min stacks min stacks max math max stacks max ensure work optimized completely system println string format work result work output worst relative diff one thread max relative increase one stack allowed system println monitoring thread slowed work worst relative diff all threads max relative increase all stacks allowed system println monitoring threads slowed work logger logged events size system println string format didn expected freeze events logger logged events size system println raw seconds system println string format control min max avg control min control max control mean control join items control results system println string format stack min max avg stack min stack max stack mean math sqrt stack stack results size math abs stack mean control mean control join items stack results system println string format all stacks min max avg stacks min stacks max stacks mean math sqrt stacks stacks results size math abs stacks mean control mean control join items stacks results join threads threads empty thread threads poll join interrupted exception threads offer equals did log expected number freeze events logger logged events size true string format relative overhead monitoring stack traces thread allowed worst relative diff one thread max relative increase one stack allowed worst relative diff one thread max relative increase one stack allowed true string format relative overhead monitoring stack traces threads allowed worst relative diff all threads max relative increase all stacks allowed worst relative diff all threads max relative increase all stacks allowed thread create and start monitoring thread display display dump all exception let monitoring thread sleep ready count down latch monitor started count down latch thread monitor create test monitor dump all monitor started start monitoring display monitor monitor started monitor kill monitor thread thread thread display display exception display sync exec runnable override shutdown thread thread thread join event loop monitor thread parameters create default parameters preference store preferences monitoring plugin default preference store event loop monitor thread parameters params event loop monitor thread parameters params event warning threshold preferences int preference constants params event error threshold preferences int preference constants params max stack samples preferences int preference constants params deadlock threshold preferences int preference constants params thread filter preferences string preference constants params noninteresting thread filter preferences string preference constants params check parameters params thread create test monitor dump all threads count down latch monitor started exception event loop monitor thread parameters args create default parameters dump all threads args event error threshold args event warning threshold event loop monitor thread args override sleep for millis nanoseconds monitor started count down sleep for millis nanoseconds queue thread start background threads count down latch background jobs done runnable background task runnable runnable override duty cycle min max degree values cluster mode skew bias mode approach min max bias range max min mid min range bias factor math exp bias random rng random true rng gaussian for mid range bias factor bias factor math exp skew time system nano time for work rng int for time system nano time sleep scale math abs rng gaussian duty cycle background jobs done await math for sleep scale time unit interrupted exception runnable background idle runnable override true background jobs done await interrupted exception random rng random active threads thread active count num background tasks active threads rng int num background idlers rng int system println string format starting background tasks background idlers num background tasks num background idlers queue thread threads array deque num background idlers num background tasks num background tasks thread thread background task runnable threads add start num background idlers thread thread background idle threads add start threads start monitoring display display thread monitor thread count down latch events registered exception display sync exec runnable override monitor thread start running display disposed shutdown thread display dispose exec runnable override shutdown thread monitor thread events ready false events ready display read and dispatch keep invoking events events ready events registered await time unit shutdown thread thread monitor event loop monitor thread monitor shutdown returns nanoseconds unit work calibrate display display system println starting calibration work display sync exec runnable override work measure avg time per work item system println string format calibration finished work unit fns work work measure avg time per work item consecutive good outliers hash avg abs rel err num samples averaged ensure memory ted ready work initialize meaningful start system nano time result work system nano time start mean start wall time system current time millis print start wall time long consecutive good avg abs rel err start system nano time result work result duration system nano time start hash result delta duration duration mean delta duration abs rel err math abs mean abs rel err consecutive good avg abs rel err avg abs rel err consecutive good consecutive good abs rel err consecutive good outliers math min num samples averaged outliers consecutive good outliers avg abs rel err abs rel err print system current time millis print system println string format still calibrating work rel err outliers avg abs rel err outliers math min num samples averaged work passing hash println method ensures optimized completely system println string format measurement converged loops work fns rel err outliers system current time millis start wall time work avg abs rel err outliers hash work string join items list double items string builder merged items string builder item items merged items length merged items append merged items append item merged items string preference store preferences monitoring plugin default preference store