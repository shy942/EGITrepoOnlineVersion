/Users/user/eclipse.platform.ui/bundles/org.eclipse.core.databinding.observable/src/org/eclipse/core/databinding/observable/set/ComputedSet.java
org eclipse core databinding observable set java util collections java util hash set java util set org eclipse core databinding observable change event org eclipse core databinding observable diffs org eclipse core databinding observable change listener org eclipse core databinding observable observable org eclipse core databinding observable stale listener org eclipse core databinding observable observable tracker org eclipse core databinding observable realm org eclipse core databinding observable stale event org eclipse core databinding observable observable value lazily calculated set automatically computes registers listeners dependencies dependencies link observable objects any change observable dependencies set recomputed this thread safe all accessing methods invoked link realm current current realm methods adding removing listeners invoked thread example compute set primes greater link observable value link integer pre observable value max writable value value type integer max set value integer observable set primes computed set set calculate max val integer max value value set result hash set outer max val iterator result iterator next integer prime integer prime value outer result add integer result system println primes quot quot max set value integer system println primes quot quot pre param type elements set computed set abstract observable set set cached set hash set dirty true stale false observable dependencies observable creates computed set realm unknown null element type computed set realm default null creates computed set realm element type param element type element type code null code unknown element type computed set object element type realm default element type creates computed set realm unknown null element type param realm realm computed set realm realm realm null creates computed set realm element type param realm realm param element type element type code null code unknown element type computed set realm realm object element type realm element type element type inner interfaces don expose each implemented separate anonymous combine reduce memory overhead number classes runnable calls calculate stores result cached set change listener stores observable dependencies list this registered listener calling observable tracker detect observable compute value change listener attached dependency private interface runnable change listener stale listener override cached set calculate cached set null cached set collections override handle stale stale event event dirty stale override handle change change event event dirty private interface interface private interface object element type get size get set size set set getter called get set override set wrapped set get set set get set dirty this run calculate method while add observable touched dependencies list observable dependencies observable tracker and monitor interface interface null dependencies stale stale event fired stale recomputing this clients assume set change indicative staleness stale false dependencies length dependencies stale stale stale dependencies length dependencies add stale listener interface dependencies dependencies dirty false cached set subclasses override method calculate set contents any dependencies calculate set link observable implementers methods tagged tracked getter computed set recognize dependency object set set calculate dirty dirty dirty true copy set bug moved stale cached set overwritten stale listener calls stale set set hash set cached set stale listening fire dirty event this implementation recomputes set lazily fire set change set diff set diff delegate set diff delegate delegate null delegate diffs compute set diff set set delegate override set additions delegate additions override set removals delegate removals listening dependencies null dependencies length observable observable dependencies observable remove change listener interface observable remove stale listener interface dependencies null stale stale stale true fire stale override stale recalculate set dirty ensure staleness correct set stale override object element type element type override add change listener change listener listener add change listener listener listening attach listeners compute set for listeners override add set change listener set change listener listener add set change listener listener listening attach listeners compute set for listeners compute set for listeners some clients add listener expect notified called value call value need careful realms method called realm see bug client calls realm receive change notifications runnable executed job figure notifications realm exec runnable override dependencies null listening but listening call value start listening observables depend set override dispose listening dispose